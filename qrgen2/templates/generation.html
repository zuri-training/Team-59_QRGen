{% load static %}
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="{% static 'gen_styles.css' %}">
    <script defer src="{% static 'gen.js' %}"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
    <!-- <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script> -->
    
    <title>QrGen59</title>
</head>
<body>
    <header class="header">
        <nav class="navbar">
            <div class="logo">
                <a href="">QrGen<span>59</span></a>
            </div>
            <div class="profile_btns">
                <div class="profile_icon">
                    <h1>K</h1>
                </div>

                <!-- Profile links  NEW-->
                <div class="profile_links">
                    <a href="">My Account</a>
                    <a href="">Dashboard</a>
                    <a href="">Log out</a>
                </div>
            </div>
        </nav>
        <!-- Button to go back to main dashboard  NEW-->
        <button class="back-button">
            <img src="{% static 'img/icons/back-arrow-icon.png' %}" alt="">
            <p>Back</p>
        </button>
    </header>
    <main class="wrapper">

        <div class="progress_bar">
            <div class="progress_details">
                <div class="progress_circle ">
                    <h6>1</h6>
                    <span class="line"></span>
                </div>
                <div class="progress_label ">
                    <p>Choose Type</p>
                </div>
            </div>
            <div class="progress_details">
                <div class="progress_circle">
                    <h6>2</h6>
                    <span class="line"></span>
                </div>
                <div class="progress_label">
                    <p>Code Content</p>
                </div>
            </div>
            <div class="progress_details">
                <div class="progress_circle">
                    <h6>3</h6>
                </div>
                <div class="progress_label">
                    <p>Download Qr code</p>
                </div>
            </div>
        </div>
        <div class="dashboard_details">
            <div class="dashboard_content_wrapper">
                <div class="dashboard_options">
                    <div class="dashboard_preview_header">
                        <div class="dashboard_header">
                            <h4>Choose your QR code type</h4>
                        </div>
                    </div>
                    <div class="dasboard_subheader">
                        <h5 class="active">Dynamic</h5>
                        <h5>Static</h5>
                    </div>
                    <div class="options">
                        <div class="single_option url_option">
                            <div class="option_header">
                                <img src="{% static 'img/icons/link-icon.png' %}" alt="icon">
                                <img src="{% static 'img/icons/link-icon-hover.png' %}" alicon">
                                <h6>Website URL</h6>
                            </div>
                            <p>Link to any website URL</p>
                        </div>
                        <div class="single_option business_option">
                            <div class="option_header">
                                <img src="{% static 'img/icons/business-icon.png' %}" alt="icon">
                                <img src="{% static 'img/icons/business-icon-hover.png' %}" alt="icon">

                                <h6>Business Card</h6>
                            </div>
                            <p>Share your contact details</p>
                        </div>
                        <div class="single_option text_option">
                            <div class="option_header">
                                <img src="{% static 'img/icons/text-icon.png' %}" alt="icon">
                                <img src="{% static 'img/icons/text-icon-hover.png' %}" alt="icon">
                                <h6>Text</h6>
                            </div>
                            <p>Display a short message</p>
                        </div>
                        <div class="single_option whatsapp_option">
                            <div class="option_header ">
                                <img src="{% static 'img/icons/whatsapp-icon.png' %}" alt="icon">
                                <img src="{% static 'img/icons/whatsapp-icon-hover.png' %}" alt="icon">
                                <h6>Whatsapp</h6>
                            </div>
                            <p>Get more contacts on whatsapp</p>
                        </div>
                        <div class="single_option pdf_option">
                            <div class="option_header">
                                <img src="{% static 'img/icons/pdf-icon.png' %}" alt="icon">
                                <img src="{% static 'img/icons/pdf-icon-hover.png' %}" alt="icon">
                                <h6>PDF</h6>
                            </div>
                            <p>Share PDF document</p>
                        </div>
                        <div class="single_option images_option">
                            <div class="option_header">
                                <img src="{% static 'img/icons/image-icon.png' %}" alt="icon">
                                <img src="{% static 'img/icons/image-icon-hover.png' %}" alt="icon">

                                <h6>Images</h6>
                            </div>
                            <p>Share multiple photos</p>
                        </div>
                        <div class="single_option event_option">
                            <div class="option_header">
                                <img src="{% static 'img/icons/event-icon.png' %}" alt="icon">
                                <img src="{% static 'img/icons/event-icon-hover.png' %}" alt="icon">
                                <h6>Event</h6>
                            </div>
                            <p>Promote any event</p>
                        </div>
                        <div class="single_option email_option">
                            <div class="option_header">
                                <img src="{% static 'img/icons/email.png' %}" alt="icon">
                                <img src="{% static 'img/icons/email-icon-hover.png' %}" alt="icon">
                                <h6>Email</h6>
                            </div>
                            <p>Get email messages</p>
                        </div>
                    </div>
                </div>
                <div class="dashboard_options code_content">
                    <div class="url_content">
                        <h6>Website URL</h6>
                        <p class="big_para">Submit URL for your QR code</p>
                        <form method='POST' action="{% url 'qrgen2:generate' %}">
                            {% csrf_token %}
                            <input type="text" name="url" id="website" placeholder="https://" value="https://">
                            <input type="text" name="qrcode_type" value="dynamic" hidden>
                            <input type="text" name="action_type" value="web" hidden>
                            <input class="generate_button" type="submit" value="Generate Qr code" name="generate" onclick="submit_form(this.form, 'url')">
                        </form>
                        <p>Your QR code will open this URL</p>
                    </div>
                    <div class="business_content">
                        <h6>Business Card</h6>
                        <p class="big_para">Submit URL for your QR code</p>
                        <form action="">
                            <input type="text" name="text" id="business" >
                            <input class="generate_button" type="submit" value="Generate Qr code">
                        </form>
                        <p>Your QR code will open this URL</p>
                    </div>
                    <div class="text_content">
                        <h6>Text</h6>
                        <p class="big_para">Type any text below</p>
                        <form action="">
                            <input type="text" name="text" id="text" placeholder="Enter some text......(not more than 300 characters)">
                            <inpu=t class="generate_button" type="submit" value="Generate Qr code">
                        </form>
                        <p>Your QR code will display this text.</p>
                    </div>
                    <div class="whatsapp_content">
                        <h6>Whatsapp</h6>
                        <p class="big_para">Input your phone number.</p>
                        <form action="">
                            <input type="number" name="number" id="number" placeholder="Phone number (with country code)">
                            <input class="generate_button" type="submit" value="Generate Qr code">
                        </form>
                        <p>Your QR code will open up a chat on whatsapp.</p>
                    </div>
                    <div class="email_content">
                        <h6>Email</h6>
                        <p class="big_para">Submit email for your QR code</p>
                        <form action="">
                            <input type="email" name="email" id="email">
                            <input class="generate_button" type="submit" value="Generate Qr code">
                        </form>
                        <p>Your QR code will open this URL</p>
                    </div>
                    <div class="pdf_content">
                        <h6>PDF</h6>
                        <p class="big_para">Select any PDF from your files</p>
                        <form action="{% url 'qrgen2:generate' %}" method='POST' enctype="multipart/form-data">
                            {% csrf_token %}
                            <input type="text" name="qrcode_type" value="dynamic" hidden>
                            <input type="text" name="action_type" value="pdf" hidden>
                            <input type="file" name="upload_file" id="pdffile">
                            <input type="text" disabled placeholder="Upload a PDF (not more than 20MB)">
                            <a id="pdfbtn">Upload</a>
                            <input class="generate_button" type="submit" value="Generate Qr code" name="generate" onclick="submit_form(this.form)">
                        </form>
                        <p>Your QR code will open this PDF.</p>
                    </div>
                    <div class="image_content">
                        <h6>Images</h6>
                        <p class="big_para">Upload images here</p>
                        <form action="">
                            <input type="file" name="imgfile" id="imgfile" hidden>
                            <input type="text" disabled placeholder="PNG or JPEG format.">
                            <button id="imgbtn">Upload</button>
                            <input class="generate_button" type="submit" value="Generate Qr code">
                        </form>
                        <p>Your QR code will open these images.</p>
                    </div>
                    <div class="event_content">
                        <h6>Event URL</h6>
                        <p class="big_para">Submit URL for your QR code</p>
                        <form action="">
                            <input type="text" name="event" id="event">
                        </form>
                        <p>Your QR code will open this URL</p>
                    </div>
                </div>
                <div class="dashboard_options download_share">
                    <div class="buttons">
                        <button class="download_btn_option">
                            <img src="{% static 'img/icons/download-button-icon.png' %}" alt="">
                            <p>Download</p>
                        </button>
                        <button class="share_btn">
                            <img src="{% static 'img/icons/share-icon.png' %}" alt="">
                            <p>Share</p>
                        </button>

                        <!-- Share notification  NEW-->
                        <div class="share_notification">
                            <h1>feature only available on mobile devices</h1>
                        </div>

                        <!-- Download Options  NEW-->
                        <div class="download_options">
                            <p>Select your format</p>

                            <!-- BUTTON FOR DOWNLOADING IN PNG -->
                            <button class="download_btn" id="btn_png">
                                <img src="{% static 'img/icons/download-button-icon.png' %}" alt="">
                                <p>Download PNG</p>
                            </button>

                            <!-- BUTTON FOR DOWNLOADING IN JPEG -->
                            <button class="download_btn" id="btn_jpeg">
                                <img src="{% static 'img/icons/download-button-icon.png' %}" alt="">
                                <p>Download JPEG</p>
                            </button>

                            <!-- BUTTON FOR DOWNLOADING IN PDF -->
                            <button class="download_btn" id="btn_pdf">
                                <img src="{% static 'img/icons/download-button-icon.png' %}" alt="">
                                <p>Download PDF</p>
                            </button>
                            <img class="cancel" src="{% static 'img/icons/basic-cancel-icon.png' %}" alt="">
                        </div>
                    </div>
                </div>
            </div>
            <div class="qrcode_section">
                <div class="qrcode_box">
                    <div class="option_preview">
                        <h5 class="text">Please select one & your 
                            preview will show here
                        </h5>
                    </div>
                    <!-- WHERE THE CODE WILL BE GENERATED -->
                    <div class="generated_code hide">
                        <!-- THE ACHOR TAG WILL TRIGGER THE CODE GENERATION -->
                        <a>Preview</a>
                        <!-- CODE GENERATED WILL BE CONTAINED IN THIS IMAGE -->
                        <img src="" alt="Qr Code" id="generated_qrcode">
                        <p>Scanning the QR code will 
                            redirect you to the website.</p>
                    </div>
                </div>
            </div>
        </div>
        <div class="dashboard_footer hide">
            <div class="dashboard_footer_btn hide">
                <button class="back hide">
                    <img src="{% static 'img/icons/arrow-left.png' %}" alt="">
                    <p>Previous</p>
                </button>
                <button class="continue">
                    <p>Next</p>
                    <img src="{% static 'img/icons/arrow-right.png' %}" alt="">
                </button>
            </div>
        </div>
    </main>

    {% comment %} Ajax Script {% endcomment %}
    
    <script type="text/javascript">

        // CSRF token setup for Ajax request
        $(function() {
            $.ajaxSetup({
                headers: {
                    "X-CSRFToken": $('[name=csrfmiddlewaretoken]').val()
                }
            })
        });

        function submit_form (form, type) {
            form.addEventListener('submit', function(e){
                e.preventDefault()

                if (type == "upload") {
                    // console.log(form.upload_file.files[0]);

                    // var upload_file = form.upload_file.files[0];

                    // Yet to find an effective way to send the uploaded file to the backend using Ajax



                }
                if (type == "url") {
                    var url = form.url.value
                }


                var action_type = form.action_type.value;
                var qrcode_type = form.qrcode_type.value;

                // making the ajax call

                $.ajax({
                    type:"POST",
                    // processData: false,          // this causes a Bad Request
                    url: "{% url 'qrgen2:generate' %}",
                    data: {
                        url: url ? url : null,
                        // upload_file: form.upload_file.files[0] ? form.upload_file.files[0] : null,
                        action_type: action_type,
                        qrcode_type: qrcode_type,
                        generate: form.generate.value                    
                    },

                    // data: form_data,

                    success: function(response) {
                        console.log('Success');
                        form.generate.value = 'QRCode Generated, please proceed!';
                        form.generate.setAttribute("disabled", "");
                        
                        // get the created qrcode

                        var qrcode = JSON.parse(response["qrcode"]);
                        var qrcode_img = qrcode[0]["fields"]["img"];
                        console.log(qrcode);
                        console.log(qrcode_img);
                        
                        // update the qrcode image

                        document.getElementById('generated_qrcode').setAttribute("src", "/static/" + qrcode_img.slice(14));
                    }   
                })

            })
        }


    </script>
    </body>
</html>